let md5 = require('md5')let userController = require('../../database/controller/user')let $util = require('../../util')var login_rule = new $util.rule({  rules: {    password: {      required: true    },    username: {      required: true    }  }})module.exports = function (router) {  router.post('/user/login', async function(req, res, next) {    try{      let userJson = req.body      let ruleBack = login_rule.test({        username: userJson.username,        password: userJson.password      })      if(req.session.userinfo){        res.json($util.message.error({        }, '请勿重复登录'))        return      }      if(!ruleBack.pass){        res.json($util.message.error({          error: ruleBack.info        }, '验证失败，请检查所传字段'))        return      }      let userinfo = await userController.getUserInfo({        username : userJson.username      })      if(!userinfo){        res.json($util.message.success({        }, '登录失败，用户不存在'))        return      }      let userpassword = md5(userJson.password)      if(userpassword == userinfo.password){        req.session.userinfo = userinfo        res.json($util.message.success({}, '登录成功'))        return      }      res.json($util.message.success({}, '登录失败，密码不正确'))    }catch (e){      res.json({        info: '失败'      })      next(e)    }  })  router.post('/user/quit', function (req, res, next) {    req.session.userinfo = null    res.json($util.message.success({}, '退出登录成功'))  })}